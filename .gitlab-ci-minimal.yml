# Flora & Fauna CI/CD Pipeline - Stage 2
image: alpine:latest

variables:
  PROJECT_STAGE: "stage-2"
  PROJECT_VERSION: "v2.0.0"
  PREVIOUS_STAGE: "stage-1"
  PREVIOUS_VERSION: "v1.0.0"

stages:
  - validate
  - tag

# Stage 2: File Validation + Chatbot Components
validate_files:
  stage: validate
  script:
    - echo "ğŸŒ¿ Flora & Fauna Data Collection App - Stage 2"
    - echo "âœ… Validating project files..."
    - ls -la
    - echo "âœ… app.py exists:" && ls app.py
    - echo "âœ… requirements.txt exists:" && ls requirements.txt
    - echo "âœ… Checking for supabase_db.py:" && ls supabase_db.py || echo "âš ï¸ supabase_db.py not found"
    - echo "âœ… Checking for chatbot.py:" && ls chatbot.py || echo "âš ï¸ chatbot.py not yet created"
    - echo "âœ… Basic validation complete!"
    - echo "ğŸ“‹ Stage 1 features verified:"
    - echo "   - Multi-format data collection âœ…"
    - echo "   - Location detection âœ…" 
    - echo "   - Cloud storage integration âœ…"
    - echo "   - Data viewing functionality âœ…"
    - echo "ğŸ“‹ Stage 2 features (in progress):"
    - echo "   - AI Chatbot integration ğŸš§"
    - echo "   - Database query capabilities ğŸš§"
    - echo "   - Natural language responses ğŸš§"

# Create tags for Stage 2 completion
create_stage_tag:
  stage: tag
  script:
    - apk add --no-cache git
    - echo "ğŸ·ï¸ Creating Stage 2 completion tags..."
    - git config --global user.email "ci@gitlab.com"
    - git config --global user.name "GitLab CI"
    - |
      if ! git tag | grep -q "$PROJECT_STAGE"; then
        git tag -a "$PROJECT_STAGE" -m "Stage 2: Flora & Fauna App with AI Chatbot - Database query capabilities"
        echo "âœ… Created tag: $PROJECT_STAGE"
      else
        echo "â„¹ï¸ Tag $PROJECT_STAGE already exists"
      fi
    - |
      if ! git tag | grep -q "$PROJECT_VERSION"; then
        git tag -a "$PROJECT_VERSION" -m "Version 2.0.0: Added AI chatbot for database queries and natural language responses"
        echo "âœ… Created tag: $PROJECT_VERSION"
      else
        echo "â„¹ï¸ Tag $PROJECT_VERSION already exists"
      fi
    - echo "ğŸ¯ Stage 2 milestone tagged successfully!"
  only:
    - main
    - master
  when: manual
